{% extends 'UserAuth/base.html' %}
{% load i18n %}

{% block body %}
    <h1>{% trans "Spotify Wraps" %}</h1>
    <ul>
        {% for wrap in wraps %}
        <li>
            <h2>{{ wrap.title }}</h2>
            <a href="{% url 'view_wrap' wrap.uuid %}">{% trans "View this wrap" %}</a>
            <p>{% trans "Posted by:" %} {{ wrap.user.username }}</p>
            <form class="delete" method="post" action="{% url 'delete_wrap' wrap.uuid %}">
                {% csrf_token %}
                <button type="submit">{% trans "Delete" %}</button>
            </form>
        </li>
        {% endfor %}
    </ul>
    <a href="{% url 'select_wraps_to_post' %}"><button>{% trans "Post" %}</button></a>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                fetch(this.action, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('input[name="csrfmiddlewaretoken"]').value
                    }
                }).then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Request failed.');
                }).then(data => {
                    console.log(data);
                }).catch(error => {
                    console.error(error);
                });
            });
        });
    });
</script>
{% endblock %}